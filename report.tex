%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%
%%  LaTeX + CJK ģ�壬ֻ��� A4 ֽ������Paper��
%%
%%  Ver 1.02 By DeathKing @ <dk.hit.edu.cn>
%%  Ver 1.01 By rabbitbug @ www.ctex.org
%%  Ver 1.0 by oLo @ bbs.ustc.edu.cn
%%
%%  You can mofify it and distribute it freely:)
%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%  ����ģ�壺A4 ֽ��С���֣����У��ɸ���Ҫ���˫�� twocolumn��
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\documentclass[a4paper,12pt,onecolumn,twoside]{article}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%  packages
%    �ⲿ��������Ҫ�õ��İ�
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\usepackage{CJK}         % CJK ����֧��
\usepackage{fancyhdr}
\usepackage{amsmath,amsfonts,amssymb,graphicx}    % EPS ͼƬ֧��
% \usepackage{subfigure}   % ʹ����ͼ��
\usepackage{indentfirst} % ���Ķ�����������
\usepackage{bm}          % ��ʽ�еĴ����ַ���������\boldsymbol��
\usepackage{multicol}    % ����˫��
\usepackage{indentfirst} % �����׶�����
% \usepackage{picins}      % ͼƬǶ������� ������Ƭ
\usepackage{abstract}    % 2���ĵ���һ��ժҪ���ؼ��ֺ��
\usepackage{stfloats}
\usepackage{enumerate}
\usepackage{enumitem}
\usepackage{float}
\usepackage{multirow}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%  lengths
%    ����������ض���ҳ��߾࣬ʹ��������Ŀ���ϰ�ߡ�
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\addtolength{\topmargin}{-54pt}
\setlength{\oddsidemargin}{-0.9cm}  % 3.17cm - 1 inch
\setlength{\evensidemargin}{\oddsidemargin}
\setlength{\textwidth}{17.00cm}
\setlength{\textheight}{24.00cm}    % 24.62
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%  ��������ʽ������title��author��affiliation��email�ȡ�
%  ���κ��õ����ĵĵط�����\begin{CJK} ... \end{CJK}������������
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\renewcommand{\baselinestretch}{1.1} %�����м��
\parindent 22pt %���¶�����������

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% ���⣬���ߣ�ͨ�ŵ�ַ����
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{CJK}{GBK}{song}
\title{\huge{Final Report}} %\thanks{�ո�����:~XXXX$-$XX$-$XX. ������Ŀ��������Ȼ��ѧ����������Ŀ~(51685168)}}
\author{Minghao Li, Huidong Lin, Wenyu Huang, Jingchao Yu\\[2pt]
}
\date{}  % ��һ������ȥ��Ĭ�ϵ�������ʾ
\end{CJK}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% ��ҳҳüҳ�Ŷ���
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%\fancypagestyle{plain}{
%\fancyhf{}
%\lhead{��~XX~��\quad ��~X~��\\
%\scriptsize{XXXX~��~XX~��}}
%\chead{\centering{��~~��~~ȡ~~��~~��\\
%\scriptsize{\textbf{The trip to get the Sutra}}}}
%\rhead{Vol. XX, No. XX\\
%\scriptsize{October, 2004}}
%\lfoot{}
%\cfoot{}
%\rfoot{}}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% ��ҳ�������żҳ��ͬ����ҳüҳ��
% R,C,L�ֱ���������ң�O,E������żҳ
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%\pagestyle{fancy}
%\fancyhf{}
%\fancyhead[RE]{��~XX~��}
%\fancyhead[CE]{��~~��~~ȡ~~��~~��}
%\fancyhead[LE,RO]{\thepage}
%\fancyhead[CO]{��~~��ȣ���ĸ��������������������̷��������}
%\fancyhead[LO]{��~X~��}
%\lfoot{}
%\cfoot{}
%\rfoot{}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% ������������������float���������� figure, table���������¶���
% figure��ʹ֮���Ը���������Ҫ��λ�á�tableҲͬ������figure��Ϊ
% table�Ϳ��ԡ�
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newenvironment{figurehere}
  {\def\@captype{figure}}
  {}
\makeatother


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%  ��������
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{document}
\begin{CJK*}{GBK}{song}
% \CJKcaption{GB}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%  �Զ�������
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% ����ʹ�����������ϱ���ʽ��ʾ
\newcommand{\supercite}[1]{\textsuperscript{\cite{#1}}}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%  ��ʾtitle������ҳ��Ϊ�գ�����־��Ҫ��
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\maketitle

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%  ����ժҪ
%  ����ժҪ���ؼ��ʣ���ͼ����ŵ�ҳ�߾�
%  ��Ӣ��ͬʱ����
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\setlength{\oddsidemargin}{ 1cm}  % 3.17cm - 1 inch
\setlength{\evensidemargin}{\oddsidemargin}
\setlength{\textwidth}{13.50cm}
\vspace{-.8cm}
\begin{center}
\parbox{\textwidth}{
\CJKfamily{hei}\textbf{Abstract}\quad \CJKfamily{kai}~Our team choose an 
android application which functions image style transfer. We measure 
the execution time for each part of the application and propose a computation 
partitioning method based on the analysis of data transmission and execution time.
We evaluate the completion time of the proposed method and
the local execution method in both 4G and WIFI network conditions.  
It turns out that the appropriate partitioning method improve the performance
of the application. 
%In our experiments the new system show great performance which means we make a correct design.\\

%\CJKfamily{hei}�ؼ���\quad\CJKfamily{kai}��ң���ĸ������ۣ��칬\\
%\CJKfamily{hei}��ͼ�����\quad TG9527\qquad  \CJKfamily{hei}���ױ�ʶ��\quad A
}
\end{center}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%  Ӣ��ժҪ
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%\vspace{.1cm}
%\begin{center}
%\parbox{\textwidth}{
%{\large{\textbf{Analysis and simulation of the peaches in the birthday party of lady Wang Mu}}}\\
%\vspace{-0.5cm}
%\begin{center}
%\textbf{Hou Ge, Ba Jie}\\[2pt]
%\small{\textit{(Dept. Qu Jing, New Western Univ., Changan Da Tang 123456, China)}}\\[2pt]
%\end{center}
%{\small{\textbf{Abstract}\quad The peaches in the birthday party of lady Wang Mu were so delicious that I want to dwell on the analysis and simulation on them. So that I can bring some of them to my kids in Hua Guo Shan.\\
%\textbf{Key Words}\quad Peach, lady Wang Mu, birthday party, Heaven palace}}
%}
%\end{center}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%  ���±��(���Ͻ�)
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% \begin{minipage}[c]{10cm}
% \vspace{-35.5cm}
% ���±��~~~~1005$-$0388(2004)05$-$0505$-$04
% \end{minipage}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%  �����ɴ˿�ʼ��������������������������������������������������
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%  �ָ�����ҳ�߾�
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\setlength{\oddsidemargin}{-.5cm}  % 3.17cm - 1 inch
\setlength{\evensidemargin}{\oddsidemargin}
\setlength{\textwidth}{17.00cm}
\CJKfamily{song}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%  ������ʼ
% \begin{multicols}{2}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Introduction}
Image style transfer\cite{1508.06576} is a technique used to generate an image
that look like the input content image but in the style of the input
style image with the help of convolutional neural networks(CNN).
The Android application we choose is performing the image 
style-transfer task completely on mobile devices. In the experiments,
we analyze the execution time of each module in the application and 
propose a computation partitioning method in order to improve the 
poor performance of the locally-executed application. We evaluate the
performance of our redesigned application under different network 
conditions.

\section{Our works}
\subsection{Application}
The application allows users to input an image and select the predefined
style image to perform style-transfer on the input image. 
As shown in Fig \ref{fig:transfer}, the application requires
a photo from camera as an input image and generate an image with
similar texture but different style.

%效果图放这

\begin{figure}[!hbt]
  \begin{minipage}[t]{0.5\linewidth}
    \centering
    \includegraphics[width=2.2in]{origin}
    \label{fig:origin}
    \end{minipage}
    \begin{minipage}[t]{0.5\linewidth}
    \centering
    \includegraphics[width=2.2in]{transfer}
    \label{fig:transfer}
  \end{minipage}
  \caption{Effect demo of the application}
\end{figure}

% \subsection{Computation partitioning}
\subsection{Performance Analysis}

The uses structure of the application is illustrated with Fig~\ref{fig:uses}.
The \emph{Style Transfer} part in the workflow comprises four procedures: 
\textit{Rebuild input tensor}, \textit{Tensorflow initiation}, 
\textit{Tensorflow inference} and \textit{Rebuild output image}.
To \textit{Rebuild input tensor}, the pixel stream is decoded
into RGB channel as input tensor, hence input tensor is 3 times
large as the pixel stream. In the \textit{Tensorflow initiation}
, the CNN model is loaded for inference. 
Then \textit{Tensorflow inference} is responsible for CNN 
computation for the input tensor and generate the output tensor.
In the \textit{Rebuild output image}, 
the output tensor is translated to pixel stream.
Then the output stream is translated to bitmap and rescaled to origin
image size.


\begin{figure}[!htb] %H为当前位置，!htb为忽略美学标准，htbp为浮动图形
  \centering %图片居中
  \includegraphics[width=0.7\textwidth]{uses} %插入图片，[]中设置图片大小，{}中是图片文件名
  \caption{Uses structure of the application} %最终文档中希望显示的图片标题
  \label{fig:uses} %用于文内引用的标签
\end{figure}

In order to partition computation tasks,
we evaluate the execution time of each procedure of the application
on both mobile devices and a server. To obtain general evaluation, we
evaluate the execution time on 3 mobile devices and use average
values as execution time measure.
The evaluation time showed in Table \ref{tb:1} indicates that the 
computations about neural network including 
\textit{Tensorflow initiation}
and \textit{Tensorflow inference}\cite{tensorflow2015-whitepaper} 
procedures occupy most of the execution time of the application. 


% On the other hand, the execution time of \textit{Rebuilding} parts 
% are also considered to 
% be computed on a server. In this manner, 
% Considering the 

% \begin{table}[H]
%   \centering
%   \caption{Execution Time on Mobile Devices and Server}\label{tb:1}
%   \begin{tabular}{ccc}
%     \hline
%     procedure & execution time on mobile devices(avg) & execution time on server\\
%     \hline
%     Tensorflow initiation & 351ms & 228ms\\
    
%     Image scaling & 28ms & 11ms\\
    
%     Rebuild input tensor & 252ms & 103ms\\
    
%     Tensorflow inference & 9920ms & 6960ms\\
    
%     Rebuild output image & 220ms & 88ms\\
%     \hline
%   \end{tabular}
% \end{table}

\begin{table}[H]
  \centering
  \caption{Execution Time on Mobile Devices and Server}\label{tb:1}
  \begin{tabular}{|c|c|c|c|c|c|}
  \hline
  \multirow{3}{*}{Procedure} & \multicolumn{5}{c|}{Execution Time(ms)}                      \\ \cline{2-6} 
                             & \multicolumn{4}{c|}{Mobile Device} & \multirow{2}{*}{Server} \\ \cline{2-5}
                             & P9    & R9 Plus  & Honor 8  & avg  &                         \\ \hline
  Tensorflow initiation      & 342   & 364      & 344      & 350  & 228                     \\ \hline
  Image scaling              & 27    & 30       & 27       & 28   & 11                      \\ \hline
  Rebuild input tensor       & 247   & 258      & 251      & 252  & 103                     \\ \hline
  Tensorflow inference       & 9577  & 10485    & 9698     & 9920 & 6960                    \\ \hline
  Rebuild output image       & 213   & 232      & 216      & 220  & 88                      \\ \hline
  \end{tabular}
  \end{table}

\subsection{System Design and Architecture}

Intuitively, we intend to allocate the computation
work about CNN(including \textit{Tensorflow initiation}
and \textit{Tensorflow inference}) 
to a server where 
the computation work has been greatly improved.

The format translation between pixel stream and tensor
(including \textit{Rebuild input tensor} and 
\textit{Rebuild output image})
takes unnegligible time. 
Assume that we assign the \textit{Rebuilding} tasks 
to local devices instead of the server, 
the input tensor instead of the pixel stream transmitted
to the server definitely increases network latency as the
input tensor is larger than the pixel stream. 
On the other hand, worse local execution performance increases
the computation time for \textit{Rebuilding input tensor}
and \textit{Rebuilding output image} procedures compared to 
server. So the local execution for these procedures does not 
help to improve application performance.

The \textit{Image scaling} procedure is considered negligible
in execution time
and therefore assigned to local devices.

Therefore, we consider a computation partitioning method that
allocates \textit{Rebuild input tensor}, 
\textit{Tensorflow initiation}, \textit{Tensorflow inference} 
and \textit{Rebuild output image} procedures 
to a server while other computations tasks to mobile devices.
As a result, the computation partitioning 
of the application is illustrated in Fig \ref{fig:partition}.


 \begin{figure}[!hbt]
   \centering
   \includegraphics[width=0.8\textwidth]{uses-partition}
    \caption{Computation Partitioning Method}
    \label{fig:partition}
 \end{figure}

 For application deployment, the Component-Connector structure
 is shown in Fig \ref{fig:C&C}, where we point out the transmission data
 through network. We consider a simple situation in which we have serveral
 end users and no requirement for high concurrency. 

\begin{figure}[!htb] %H为当前位置，!htb为忽略美学标准，htbp为浮动图形
  \centering %图片居中
  \includegraphics[width=0.5\textwidth]{partition} %插入图片，[]中设置图片大小，{}中是图片文件名
  \caption{Client-Server structure of the application} %最终文档中希望显示的图片标题
  \label{fig:C&C} %用于文内引用的标签
\end{figure}

\section{Experiments and Results}

Based on the proposed computation partitioning method,
we test the application performance on 3 different mobile devices
and make a comparison to the original local execution method. 
We compare the local execution method and the proposed 
partitioning method 
over performance in terms of completion time of the program
in both 4G and WIFI network conditions. For convenience of experiment,
we deploy both local execution method and remote partitioning method
and enable the partitioning method by turning on the 
Working Remotely button as shown in Fig \ref{fig:transfer}. 
We test 3 times for each mobile device with both local execution
and remote partitioning methods and obtain the average completion
time as shown in Fig~\ref{tb:result}.

% \begin{table}[!hbt]
%   \caption{Completion time of Local execution and Proposed Method}
%   \centering\label{tb:result}
%   \begin{tabular}{|c|c|c|}
%   \hline
%   % \multirow{2}{*}{} & \multicolumn{2}{c|}{Network Condition} \\ \cline{2-3} 
%                                        & WIFI                & 4G              \\ \hline
%   Local execution                      &  12.24s             &  12.24s         \\ \hline
%   Proposed Method                     &  7.50s              &  7.99s          \\ \hline
%   \end{tabular}
%   \end{table}

  \begin{table}[!hbt]
    \caption{Completion time of Local execution and Proposed Method}
  \centering\label{tb:result}
    \begin{tabular}{|c|c|c|c|c|c|c|c|c|}
    \hline
    \multirow{2}{*}{Method} & \multicolumn{2}{c|}{P9}    & \multicolumn{2}{c|}{R9 Plus} & \multicolumn{2}{c|}{Honor 8} & \multicolumn{2}{c|}{Avg}   \\ \cline{2-9} 
                            & WIFI         & 4G          & WIFI          & 4G           & WIFI          & 4G           & WIFI         & 4G          \\ \hline
    Local Execution         & \multicolumn{2}{c|}{11.82s} & \multicolumn{2}{c|}{12.92s}   & \multicolumn{2}{c|}{11.97s}   & \multicolumn{2}{c|}{12.24s} \\ \hline
    Proposed partition      & 7.48s         & 7.87s        & 7.53s          & 8.17s         & 7.49s          & 7.94s        & 7.5s          & 7.99s       \\ \hline
    \end{tabular}
    \end{table}

It turns out that the performance of mobile devices in the experiments
are similar and the proposed method have obvious improvement 
on the three mobile devices.

\section{Conclusions}

Our experiments indicates that partitioning by Client-Server structure improves performance a lot when only single client is online.

\section{References}

\nocite{1508.06576}
\nocite{tensorflow2015-whitepaper}

\bibliographystyle{plain}
\bibliography{bibtex} 


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%  �ο�����
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%\small
%\begin{thebibliography}{99}
%\setlength{\parskip}{0pt}  %����֮�����ֱ����
%\bibitem{Wu}��ж�. ���μ�~[M], ��14XX��.
%\bibitem{Xuan} ����. ���������ѧ��~[J], ��~6XX~��, 1(2): 23-55.

%\end{thebibliography}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% ���߼���,�������ͼƬ��picins�����\parpic����
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%\normalsize
%\parpic{%
%\includegraphics[width=3.0cm]%
%{Hou.jpg}}
%\indent ��~~��~~($xxx-$)���У����ջ���ɽ�ˣ��������ߣ�����ɮ�Ĵ�ͽ�ܣ�����ʮ���䡢���Ƽ���
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%  ��������
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% \end{multicols}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%  ���½���
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\clearpage
\end{CJK*}
\end{document}
